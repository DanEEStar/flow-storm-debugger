# Flow-storm debugger

A Clojure and ClojureScript debugger with some unique features.

![demo](./docs/flow-storm-demo.gif)

[![Clojars Project](https://img.shields.io/clojars/v/jpmonettas/flow-storm-debugger.svg)](https://clojars.org/jpmonettas/flow-storm-debugger)

## Features

- **Clojure and ClojureScript** (browser, nodejs and react-native) support.
- **Step** through expressions **forward and backward in time**.
- **Locals** inspection.
- **Multiple flows** tracing (see [flows](#flows)).
- **Save, load and share** your debugging sessions (see [saving and loading](#saving-and-loading)).
- **Call tree** execution analyzer (see [call tree](#call-tree)).
- **Layers** execution analyzer (see [layers](#layers)).
- **Inspect and explore** large expression **results**.
- Multiple ways of **jumping in time**.

## Running the debugger
```bash
clj -Sdeps '{:deps {jpmonettas/flow-storm-debugger {:mvn/version "0.3.0"}}}' -m flow-storm-debugger.server
```

And point your browser to http://localhost:7722

One instance of the debugger is enough for all your Clojure and ClojureScript projects.

## Instrumenting your code

#### TLDR;

Add [![Clojars Project](https://img.shields.io/clojars/v/jpmonettas/flow-storm.svg)](https://clojars.org/jpmonettas/flow-storm) to your project.

```clojure
(require '[flow-storm.api :as fsa])

;; connect to the debugger
(fsa/connect)

;; trace something
#trace
(->> (range)
	 (map inc)
	 (take 10)
	 (reduce +))

```

For more details on connecting to the debugger and instrumenting your code check [flow-storm](https://github.com/jpmonettas/flow-storm).

## Users Guide

### General overview

Flow-storm is a trace based debugger. This means when you run your instrumented code it will not block execution,
instead, it will trace what is happening as it execute.

It is made of two components :

- a [instrumentation library](https://github.com/jpmonettas/flow-storm), which you will need to add to your dev dependencies
in order to instrument your code.
- this debugger, which you will use to analyze your traces.

### Stepping forward and backward in time

You can use the three buttons in the top left corner to move forward and backward in time.

Press the `Reset` button to move the debugger to the first trace of the flow.

There are other ways of moving through time, see [layers](#layers) and [call tree](#call-tree).

### <a name="flows"></a> Flows

A flow is a set of traces created by forms executions and all
the traced forms down the same call stack.

This is maybe easier to understand by looking at a example.

```clojure
 #trace
 (defn foo [a b]
	(+ a b))

 #trace
 (defn bar []
   (let [a 10
		 b (foo a a)]
	 (->> (range)
		  (map inc)
		  (filter odd?)
		  (take b)
		  (reduce +))))

 (defn baz []
	#trace (+ 1 2 (+ 3 4))
	#trace (bar))

 (baz)
```

In this example we have 3 functions, the first two of them are entirely traced while for the last one we are just separately tracing two sub forms.

When `baz` executes the first traced form is going to generate one flow, while the second one is going to generate different one.

Observe the traces generated by all this functions are going to belong to the second flow since they are part of the same call stack.

### <a name="saving-and-loading"></a> Saving and loading flows

One nice thing about flows is that you can save and load them. This can be useful for comparing it with other executions of the same code,
share them so other people can take a look and maybe help you debug something or just because you want to analyze them later.

For saving a flow, just click the `Save` button on the top right corner. A popup should show asking for a file name.
Type the file name and hit enter. The flow will be stored in the same folder you are running the debugger.

For loading a stored flow, click the `Load` button, select the flow file, and you will
have the flow loaded in the debugger ready for you to start analyzing.

### <a name="call-tree"></a> Call tree

Calls tree is the tool located in the top right panel, under the `calls` tab.

![demo](./docs/calls_tree.png)

It shows how functions are being called, their arguments and their return values.

It is useful as the overview of a complicated flow, and as the starting point when
chasing a bug that involves multiple functions calls.

Clicking on function calls or returns will move the debugger to that position in time.

### <a name="layers"></a> Layers

Layers is the tool located in the top right panel, under the `layers` tab.

![demo](./docs/layers1.png)

![demo](./docs/layers2.png)

It is useful for analyzing iterations, doesn't matter if they are loops or recursive functions.

When loops are executed, expressions inside a loop are executed multiple times, possibly returning
different values or "layers" in time.

The layers tools allows you to inspect all the values the current expression evaluated to.

Clicking on any layer will also move the debugger to that point in time.

### Locals

The locals panel is the one located in the bottom right corner. It shows the current values
of your local bindings.

Clicking on any locals open a pop up showing the binding value pretty printed.

## Developers section

If you are interested in developing flow-storm-debugger take a look at [here](./docs/devs.md).
